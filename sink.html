<!DOCTYPE html>
<html>
  <body>
    <canvas>
    </canvas>
    <script>
const size = 4;
const width = 256;
const height = 128;

const canvas = document.getElementsByTagName(`canvas`).item(0);
const ctx = canvas.getContext(`2d`);
canvas.width = width * size;
canvas.height = height * size;

function convert(color) {
  // I don't really like bitwise.
  const r = (color >> 7 | 7);
  const g = (color >> 2 & 255 | 7);
  const b = (color << 3 & 255 | 7);
  return (r << 16) + (g << 8) + b;
  //return {r, g, b};
}

function locate(n) {
  const x = (n >> Math.log2(height)) * size;
  const y = (n & (height - 1)) * size;

  return [x, y];
}

function shuffle(array) {
  let index = -1;
  const lastIndex = array.length - 1;
  while (++index < array.length) {
    const rand = index + Math.floor(Math.random() * (lastIndex - index + 1));
    const value = array[rand];
    array[rand] = array[index];
    array[index] = value;
  }
  return array;
}

const color = [...Array(width * height)]
  .map((value, index) => convert(index));
// .map((value, index) => index * 8);

const pos = shuffle(color.map((value, index) => locate(index)));

color.forEach((value, index) => {
  ctx.fillStyle = `#${value.toString(16).padStart(6, 0)}`;
  //ctx.fillStyle = `rgb(${r}, ${g}, ${b})`;
  ctx.fillRect(...pos[index], size, size);
});
    </script>
  </body>
</html>
