<!DOCTYPE html>
<html>
  <body>
    <canvas id="typical"></canvas>
    <canvas id="shuffle"></canvas>
    <canvas id="Ａｒｔ"></canvas>
    <script>
'use strict';

const size = 4;
const width = 256;
const height = 128;

const [ctxTypical, ctxShuffle, ctxＡｒｔ] = [...document.getElementsByTagName(`canvas`)]
  .map(canvas => {
    canvas.width = width * size;
    canvas.height = height * size;
    return canvas.getContext(`2d`);
  });

function convert(color) {
  // I don't really like bitwise.
  const r = (color >> 7 | 7);
  const g = (color >> 2 & 255 | 7);
  const b = (color << 3 & 255 | 7);
  return `rgb(${r},${g},${b})`;
}

function locate(n) {
  const x = (n >> Math.log2(height)) * size;
  const y = (n & (height - 1)) * size;

  return [x, y];
}

function shuffle(array) {
  array = [...array];
  let index = -1;
  const lastIndex = array.length - 1;
  while (++index < array.length) {
    const rand = index + Math.floor(Math.random() * (lastIndex - index + 1));
    const value = array[rand];
    array[rand] = array[index];
    array[index] = value;
  }
  return array;
}

function fillContext(ctx, map) {
  map.forEach(value => {
    ctx.fillStyle = value.color;
    ctx.fillRect(...value.pos, size, size);
  });
}

const color = [...Array(width * height)]
  .map((value, index) => convert(index));
// .map((value, index) => index * 8);

const mapTypical = [...color]
  .map((color, index) => ({
    color,
    pos: locate(index),
  }));

const mapShuffle = shuffle(color)
  .map((color, index) => ({
    color,
    pos: locate(index),
  }));

const mapＡｒｔ = [...color]
  .map((color, index) => ({
    color,
    pos: locate(index),
  }));

fillContext(ctxTypical, mapTypical);
fillContext(ctxShuffle, mapShuffle);
fillContext(ctxＡｒｔ, mapＡｒｔ);
    </script>
  </body>
</html>
