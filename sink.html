<!DOCTYPE html>
<html>
  <body>
    <canvas id="typical"></canvas>
    <canvas id="shuffle"></canvas>
    <canvas id="ＡＲＴ"></canvas>
    <script>
const size = 4;
const width = 256;
const height = 128;

const [ctxTypical, ctxShuffle, ctxＡＲＴ] = [...document.getElementsByTagName(`canvas`)]
  .map(canvas => {
    canvas.width = width * size;
    canvas.height = height * size;
    return canvas.getContext(`2d`);
  });

function convert(color) {
  // I don't really like bitwise.
  const r = (color >> 7 | 7);
  const g = (color >> 2 & 255 | 7);
  const b = (color << 3 & 255 | 7);
  return `rgb(${r},${g},${b})`;
}

function locate(n) {
  const x = (n >> Math.log2(height)) * size;
  const y = (n & (height - 1)) * size;

  return [x, y];
}

function shuffle(array) {
  let index = -1;
  const lastIndex = array.length - 1;
  while (++index < array.length) {
    const rand = index + Math.floor(Math.random() * (lastIndex - index + 1));
    const value = array[rand];
    array[rand] = array[index];
    array[index] = value;
  }
  return array;
}

const color = [...Array(width * height)]
  .map((value, index) => convert(index));
// .map((value, index) => index * 8);

const posTypical = color.map((value, index) => locate(index));
const posShuffle = shuffle([...posTypical]);

color.forEach((value, index) => {
  ctxTypical.fillStyle = value;
  ctxTypical.fillRect(...posTypical[index], size, size);

  ctxShuffle.fillStyle = value;
  ctxShuffle.fillRect(...posShuffle[index], size, size);
});
    </script>
  </body>
</html>
